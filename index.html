<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Gastos 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { border-bottom: 3px solid #4f46e5; color: #4f46e5; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen pb-10">

    <div class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">ðŸ“Š Finanzas 2026</h1>
                <p class="text-slate-500 text-sm">Control mensual de gastos e ingresos</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportData()" class="bg-white border border-slate-300 text-slate-600 px-3 py-1.5 rounded-lg text-sm hover:bg-slate-50 transition flex items-center gap-2 shadow-sm">
                    <i class="fa-solid fa-download"></i> Backup
                </button>
                <label class="bg-white border border-slate-300 text-slate-600 px-3 py-1.5 rounded-lg text-sm hover:bg-slate-50 transition flex items-center gap-2 shadow-sm cursor-pointer">
                    <i class="fa-solid fa-upload"></i> Cargar
                    <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
                </label>
            </div>
        </div>

        <!-- Resumen Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 shadow-sm">
                <span class="text-emerald-600 font-semibold text-xs uppercase tracking-wide">Ingresos</span>
                <span class="text-xl font-bold text-emerald-700 block mt-1" id="total-income">$0.00</span>
            </div>
            <div class="bg-rose-50 p-4 rounded-2xl border border-rose-100 shadow-sm">
                <span class="text-rose-600 font-semibold text-xs uppercase tracking-wide">Gastos Pagados</span>
                <span class="text-xl font-bold text-rose-700 block mt-1" id="total-paid">$0.00</span>
            </div>
            <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100 shadow-sm">
                <span class="text-amber-600 font-semibold text-xs uppercase tracking-wide">Por Pagar</span>
                <span class="text-xl font-bold text-amber-700 block mt-1" id="total-pending">$0.00</span>
            </div>
            <div class="bg-indigo-600 p-4 rounded-2xl shadow-lg text-white relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 transform translate-x-2 -translate-y-2">
                    <i class="fa-solid fa-wallet text-5xl"></i>
                </div>
                <span class="text-indigo-200 font-semibold text-xs uppercase tracking-wide">Saldo</span>
                <span class="text-xl font-bold block mt-1" id="balance">$0.00</span>
            </div>
        </div>

        <!-- Barra de Progreso de Gastos -->
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-semibold text-slate-600">Progreso de Pagos del Mes</span>
                <span class="text-sm text-slate-500" id="progress-text">0 de 0 pagados</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-indigo-500 to-emerald-500 h-3 rounded-full transition-all duration-500" id="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <!-- Formulario para Agregar -->
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-6">
            <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-plus-circle text-indigo-500"></i> Agregar Nuevo
            </h3>
            <form id="form" class="space-y-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Tipo</label>
                        <select id="type" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer" onchange="updateCategoryOptions()">
                            <option value="gasto">ðŸ“‹ Gasto Planificado</option>
                            <option value="ingreso">ðŸ’° Ingreso</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Monto</label>
                        <input type="number" id="amount" placeholder="0.00" step="0.01" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Fecha</label>
                        <input type="date" id="date" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">CategorÃ­a</label>
                        <select id="category" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer">
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">DescripciÃ³n</label>
                        <input type="text" id="text" placeholder="Ej: Luz de enero, Netflix, etc." class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-6 rounded-xl transition shadow-md hover:shadow-lg active:scale-[0.99] self-end">
                        <i class="fa-solid fa-plus"></i> Agregar
                    </button>
                </div>
            </form>
        </div>

        <!-- Tabs de NavegaciÃ³n -->
        <div class="flex border-b border-slate-200 mb-4">
            <button onclick="switchTab('pending')" id="tab-pending" class="px-4 py-2 font-semibold text-sm tab-active transition">
                <i class="fa-solid fa-clock"></i> Pendientes <span id="pending-count" class="bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="switchTab('paid')" id="tab-paid" class="px-4 py-2 font-semibold text-sm text-slate-500 hover:text-slate-700 transition">
                <i class="fa-solid fa-check-circle"></i> Pagados <span id="paid-count" class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="switchTab('income')" id="tab-income" class="px-4 py-2 font-semibold text-sm text-slate-500 hover:text-slate-700 transition">
                <i class="fa-solid fa-coins"></i> Ingresos <span id="income-count" class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
        </div>

        <!-- Lista de Items -->
        <div id="list-container">
            <ul id="list" class="space-y-3"></ul>
            <div id="empty-state" class="text-center py-10 text-slate-400 hidden">
                <i class="fa-solid fa-inbox text-4xl mb-2"></i>
                <p>No hay items en esta secciÃ³n</p>
            </div>
        </div>

        <!-- BotÃ³n Limpiar -->
        <div class="mt-6 text-center">
            <button onclick="confirmClear()" class="text-xs text-rose-400 hover:text-rose-600 hover:underline">
                <i class="fa-solid fa-trash"></i> Limpiar Todo el Historial
            </button>
        </div>
    </div>

    <script>
        // --- Referencias DOM ---
        const totalIncomeEl = document.getElementById('total-income');
        const totalPaidEl = document.getElementById('total-paid');
        const totalPendingEl = document.getElementById('total-pending');
        const balanceEl = document.getElementById('balance');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const list = document.getElementById('list');
        const emptyState = document.getElementById('empty-state');
        const form = document.getElementById('form');
        const typeInput = document.getElementById('type');
        const textInput = document.getElementById('text');
        const amountInput = document.getElementById('amount');
        const dateInput = document.getElementById('date');
        const categoryInput = document.getElementById('category');

        // --- CategorÃ­as Expandidas ---
        const categories = {
            // Ingresos
            ingreso: {
                salario: { label: 'ðŸ’° Salario', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-money-bill-wave' },
                freelance: { label: 'ðŸ’¼ Freelance', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-laptop' },
                otros_ingresos: { label: 'ðŸ“¥ Otros Ingresos', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-hand-holding-dollar' }
            },
            // Gastos
            gastos: {
                // Servicios
                luz: { label: 'ðŸ’¡ Luz', color: 'text-yellow-600', bg: 'bg-yellow-100', icon: 'fa-lightbulb' },
                gas: { label: 'ðŸ”¥ Gas', color: 'text-orange-600', bg: 'bg-orange-100', icon: 'fa-fire' },
                agua: { label: 'ðŸ’§ Agua', color: 'text-cyan-600', bg: 'bg-cyan-100', icon: 'fa-droplet' },
                internet: { label: 'ðŸŒ Internet', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-wifi' },
                celular: { label: 'ðŸ“± Celular', color: 'text-violet-600', bg: 'bg-violet-100', icon: 'fa-mobile-screen' },
                netflix: { label: 'ðŸŽ¬ Netflix', color: 'text-red-600', bg: 'bg-red-100', icon: 'fa-tv' },
                hbo: { label: 'ðŸ“º HBO', color: 'text-purple-600', bg: 'bg-purple-100', icon: 'fa-film' },
                disney: { label: 'âœ¨ Disney+', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-wand-magic-sparkles' },
                spotify: { label: 'ðŸŽµ Spotify', color: 'text-green-600', bg: 'bg-green-100', icon: 'fa-music' },
                // Casa
                alquiler: { label: 'ðŸ  Alquiler/Hipoteca', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-house' },
                mantenimiento: { label: 'ðŸ”§ Mantenimiento', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-wrench' },
                // Comida
                supermercado: { label: 'ðŸ›’ Supermercado', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-cart-shopping' },
                comida: { label: 'ðŸ” Comida/Delivery', color: 'text-orange-600', bg: 'bg-orange-100', icon: 'fa-utensils' },
                // Transporte
                transporte: { label: 'ðŸšŒ Transporte', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-bus' },
                gasolina: { label: 'â›½ Gasolina', color: 'text-amber-600', bg: 'bg-amber-100', icon: 'fa-gas-pump' },
                // Salud
                salud: { label: 'ðŸ’Š Salud', color: 'text-teal-600', bg: 'bg-teal-100', icon: 'fa-heart-pulse' },
                gimnasio: { label: 'ðŸ‹ï¸ Gimnasio', color: 'text-indigo-600', bg: 'bg-indigo-100', icon: 'fa-dumbbell' },
                // Familia
                ninos: { label: 'ðŸ‘¶ NiÃ±os', color: 'text-pink-600', bg: 'bg-pink-100', icon: 'fa-baby' },
                escuela: { label: 'ðŸŽ“ Escuela', color: 'text-indigo-600', bg: 'bg-indigo-100', icon: 'fa-graduation-cap' },
                // Entretenimiento
                salidas: { label: 'ðŸ» Salidas', color: 'text-amber-600', bg: 'bg-amber-100', icon: 'fa-champagne-glasses' },
                cine: { label: 'ðŸŽ¬ Cine', color: 'text-rose-600', bg: 'bg-rose-100', icon: 'fa-clapperboard' },
                regalos: { label: 'ðŸŽ Regalos', color: 'text-pink-600', bg: 'bg-pink-100', icon: 'fa-gift' },
                ocio: { label: 'ðŸŽ‰ Ocio', color: 'text-fuchsia-600', bg: 'bg-fuchsia-100', icon: 'fa-face-laugh' },
                // Otros
                ropa: { label: 'ðŸ‘• Ropa', color: 'text-purple-600', bg: 'bg-purple-100', icon: 'fa-shirt' },
                educacion: { label: 'ðŸ“š EducaciÃ³n', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-book' },
                otros: { label: 'ðŸ“¦ Otros', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-box' }
            }
        };

        // --- Estado ---
        const STORAGE_KEY = 'gastos_app_2026_v2';
        let items = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let currentTab = 'pending';

        // Fecha de hoy por defecto
        dateInput.valueAsDate = new Date();

        // --- Funciones de CategorÃ­as ---
        function updateCategoryOptions() {
            const type = typeInput.value;
            categoryInput.innerHTML = '';
            
            const cats = type === 'ingreso' ? categories.ingreso : categories.gastos;
            
            for (const [key, val] of Object.entries(cats)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = val.label;
                categoryInput.appendChild(option);
            }
        }

        function getCategoryStyle(category) {
            return categories.ingreso[category] || categories.gastos[category] || categories.gastos.otros;
        }

        // --- Funciones CRUD ---
        function addItem(e) {
            e.preventDefault();
            
            if (!textInput.value.trim() || !amountInput.value) {
                return alert('Por favor completa todos los campos');
            }

            const item = {
                id: Date.now(),
                text: textInput.value.trim(),
                amount: parseFloat(amountInput.value),
                date: dateInput.value,
                category: categoryInput.value,
                type: typeInput.value,
                paid: typeInput.value === 'ingreso' // Ingresos se marcan como "procesados" automÃ¡ticamente
            };

            items.push(item);
            saveAndRender();
            
            // Reset form
            textInput.value = '';
            amountInput.value = '';
        }

        function deleteItem(id) {
            if (confirm('Â¿Eliminar este item?')) {
                items = items.filter(item => item.id !== id);
                saveAndRender();
            }
        }

        function togglePaid(id) {
            const item = items.find(i => i.id === id);
            if (item && item.type === 'gasto') {
                item.paid = !item.paid;
                if (item.paid) {
                    item.paidDate = new Date().toISOString().slice(0, 10);
                } else {
                    delete item.paidDate;
                }
                saveAndRender();
            }
        }

        // --- Renderizado ---
        function renderList() {
            list.innerHTML = '';
            
            let filteredItems = [];
            
            if (currentTab === 'pending') {
                filteredItems = items.filter(i => i.type === 'gasto' && !i.paid);
            } else if (currentTab === 'paid') {
                filteredItems = items.filter(i => i.type === 'gasto' && i.paid);
            } else if (currentTab === 'income') {
                filteredItems = items.filter(i => i.type === 'ingreso');
            }

            // Ordenar por fecha
            filteredItems.sort((a, b) => new Date(a.date) - new Date(b.date));

            if (filteredItems.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');

            filteredItems.forEach(item => {
                const li = document.createElement('li');
                const style = getCategoryStyle(item.category);
                
                li.className = 'fade-in bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center group';
                
                const isExpense = item.type === 'gasto';
                const amountColor = isExpense ? 'text-rose-600' : 'text-emerald-600';
                const amountSign = isExpense ? '-' : '+';

                li.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full ${style.bg} flex items-center justify-center ${style.color} text-lg shrink-0">
                            <i class="fa-solid ${style.icon}"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">${item.text}</p>
                            <p class="text-xs text-slate-400 font-medium">
                                ${item.date} &bull; <span class="capitalize">${style.label.replace(/^[^\s]+\s/, '')}</span>
                                ${item.paidDate ? `&bull; <span class="text-emerald-500">Pagado ${item.paidDate}</span>` : ''}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <p class="font-bold ${amountColor} text-lg">
                            ${amountSign}$${item.amount.toFixed(2)}
                        </p>
                        <div class="flex gap-1">
                            ${isExpense ? `
                                <button onclick="togglePaid(${item.id})" class="p-2 rounded-lg ${item.paid ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-400 hover:bg-emerald-100 hover:text-emerald-600'} transition" title="${item.paid ? 'Marcar como pendiente' : 'Marcar como pagado'}">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                            ` : ''}
                            <button onclick="deleteItem(${item.id})" class="p-2 rounded-lg bg-slate-100 text-slate-400 hover:bg-rose-100 hover:text-rose-600 transition opacity-0 group-hover:opacity-100" title="Eliminar">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                list.appendChild(li);
            });
        }

        function updateTotals() {
            const incomeItems = items.filter(i => i.type === 'ingreso');
            const paidItems = items.filter(i => i.type === 'gasto' && i.paid);
            const pendingItems = items.filter(i => i.type === 'gasto' && !i.paid);

            const totalIncome = incomeItems.reduce((acc, i) => acc + i.amount, 0);
            const totalPaid = paidItems.reduce((acc, i) => acc + i.amount, 0);
            const totalPending = pendingItems.reduce((acc, i) => acc + i.amount, 0);
            const balance = totalIncome - totalPaid;

            totalIncomeEl.textContent = `$${totalIncome.toFixed(2)}`;
            totalPaidEl.textContent = `$${totalPaid.toFixed(2)}`;
            totalPendingEl.textContent = `$${totalPending.toFixed(2)}`;
            balanceEl.textContent = `$${balance.toFixed(2)}`;

            // Actualizar contadores de tabs
            document.getElementById('pending-count').textContent = pendingItems.length;
            document.getElementById('paid-count').textContent = paidItems.length;
            document.getElementById('income-count').textContent = incomeItems.length;

            // Barra de progreso
            const totalExpenses = paidItems.length + pendingItems.length;
            const progress = totalExpenses > 0 ? (paidItems.length / totalExpenses) * 100 : 0;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${paidItems.length} de ${totalExpenses} pagados`;
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Actualizar estilos de tabs
            document.querySelectorAll('[id^="tab-"]').forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('text-slate-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('text-slate-500');
            
            renderList();
        }

        function saveAndRender() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
            renderList();
            updateTotals();
        }

        function confirmClear() {
            if (confirm('Â¿Borrar TODO el historial? Esta acciÃ³n no se puede deshacer.')) {
                items = [];
                saveAndRender();
            }
        }

        // --- Backup/Restore ---
        function exportData() {
            if (items.length === 0) return alert('No hay datos para exportar');
            
            const data = JSON.stringify(items, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.download = `backup_gastos_${new Date().toISOString().slice(0, 10)}.json`;
            a.href = url;
            a.click();
            alert('Backup descargado correctamente');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data)) {
                        if (confirm(`Se cargarÃ¡n ${data.length} items. Â¿Reemplazar datos actuales?`)) {
                            items = data;
                            saveAndRender();
                            alert('Datos cargados correctamente');
                        }
                    } else {
                        alert('Formato de archivo incorrecto');
                    }
                } catch (err) {
                    alert('Error al leer el archivo');
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // --- InicializaciÃ³n ---
        function init() {
            updateCategoryOptions();
            renderList();
            updateTotals();
        }

        form.addEventListener('submit', addItem);
        init();
    </script>
</body>
</html>