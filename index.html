<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Gastos 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { border-bottom: 3px solid #4f46e5; color: #4f46e5; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen pb-10">

    <div class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">üìä Finanzas 2026</h1>
                <p class="text-slate-500 text-sm">Control mensual de gastos e ingresos</p>
            </div>
            <button onclick="openBackupModal()" class="bg-white border border-slate-300 text-slate-600 px-3 py-1.5 rounded-lg text-sm hover:bg-slate-50 transition flex items-center gap-2 shadow-sm">
                <i class="fa-solid fa-cloud"></i> Backup
            </button>
        </div>

        <!-- Resumen Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 shadow-sm">
                <span class="text-emerald-600 font-semibold text-xs uppercase tracking-wide">Ingresos</span>
                <span class="text-xl font-bold text-emerald-700 block mt-1" id="total-income">$0.00</span>
            </div>
            <div class="bg-rose-50 p-4 rounded-2xl border border-rose-100 shadow-sm">
                <span class="text-rose-600 font-semibold text-xs uppercase tracking-wide">Gastos Pagados</span>
                <span class="text-xl font-bold text-rose-700 block mt-1" id="total-paid">$0.00</span>
            </div>
            <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100 shadow-sm">
                <span class="text-amber-600 font-semibold text-xs uppercase tracking-wide">Por Pagar</span>
                <span class="text-xl font-bold text-amber-700 block mt-1" id="total-pending">$0.00</span>
            </div>
            <div class="bg-indigo-600 p-4 rounded-2xl shadow-lg text-white relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 transform translate-x-2 -translate-y-2">
                    <i class="fa-solid fa-wallet text-5xl"></i>
                </div>
                <span class="text-indigo-200 font-semibold text-xs uppercase tracking-wide">Saldo</span>
                <span class="text-xl font-bold block mt-1" id="balance">$0.00</span>
            </div>
        </div>

        <!-- Barra de Progreso de Gastos -->
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-semibold text-slate-600">Progreso de Pagos del Mes</span>
                <span class="text-sm text-slate-500" id="progress-text">0 de 0 pagados</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-indigo-500 to-emerald-500 h-3 rounded-full transition-all duration-500" id="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <!-- Formulario para Agregar -->
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-6">
            <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-plus-circle text-indigo-500"></i> Agregar Nuevo
            </h3>
            <form id="form" class="space-y-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Tipo</label>
                        <select id="type" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer" onchange="updateCategoryOptions()">
                            <option value="gasto">üìã Gasto Planificado</option>
                            <option value="ingreso">üí∞ Ingreso</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Monto</label>
                        <input type="number" id="amount" placeholder="0.00" step="0.01" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Fecha</label>
                        <input type="date" id="date" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Categor√≠a</label>
                        <select id="category" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer">
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Descripci√≥n</label>
                        <input type="text" id="text" placeholder="Ej: Luz de enero, Netflix, etc." class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                    </div>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-6 rounded-xl transition shadow-md hover:shadow-lg active:scale-[0.99] self-end">
                        <i class="fa-solid fa-plus"></i> Agregar
                    </button>
                </div>
            </form>
        </div>

        <!-- Tabs de Navegaci√≥n -->
        <div class="flex border-b border-slate-200 mb-4">
            <button onclick="switchTab('pending')" id="tab-pending" class="px-4 py-2 font-semibold text-sm tab-active transition">
                <i class="fa-solid fa-clock"></i> Pendientes <span id="pending-count" class="bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="switchTab('paid')" id="tab-paid" class="px-4 py-2 font-semibold text-sm text-slate-500 hover:text-slate-700 transition">
                <i class="fa-solid fa-check-circle"></i> Pagados <span id="paid-count" class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="switchTab('income')" id="tab-income" class="px-4 py-2 font-semibold text-sm text-slate-500 hover:text-slate-700 transition">
                <i class="fa-solid fa-coins"></i> Ingresos <span id="income-count" class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full text-xs ml-1">0</span>
            </button>
        </div>

        <!-- Lista de Items -->
        <div id="list-container">
            <ul id="list" class="space-y-3"></ul>
            <div id="empty-state" class="text-center py-10 text-slate-400 hidden">
                <i class="fa-solid fa-inbox text-4xl mb-2"></i>
                <p>No hay items en esta secci√≥n</p>
            </div>
        </div>

        <!-- Bot√≥n Limpiar -->
        <div class="mt-6 text-center">
            <button onclick="confirmClear()" class="text-xs text-rose-400 hover:text-rose-600 hover:underline">
                <i class="fa-solid fa-trash"></i> Limpiar Todo el Historial
            </button>
        </div>
    </div>

    <!-- Modal de Backup -->
    <div id="backup-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4" onclick="if(event.target === this) closeBackupModal()">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-slate-200 flex justify-between items-center">
                <h3 class="font-bold text-lg text-slate-800"><i class="fa-solid fa-cloud text-indigo-500"></i> Backup de Datos</h3>
                <button onclick="closeBackupModal()" class="text-slate-400 hover:text-slate-600 text-xl">&times;</button>
            </div>
            
            <div class="p-4 space-y-4 max-h-[70vh] overflow-y-auto">
                <!-- Exportar -->
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100">
                    <h4 class="font-semibold text-emerald-700 mb-3"><i class="fa-solid fa-download"></i> Guardar Backup</h4>
                    <div class="flex flex-col gap-2">
                        <button onclick="exportAsFile()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                            <i class="fa-solid fa-file-arrow-down"></i> Descargar archivo .txt
                        </button>
                        <button onclick="copyToClipboard()" class="w-full bg-white border border-emerald-300 text-emerald-700 py-2 px-4 rounded-lg transition hover:bg-emerald-50 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-copy"></i> Copiar al portapapeles
                        </button>
                    </div>
                </div>

                <!-- Importar -->
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="font-semibold text-blue-700 mb-3"><i class="fa-solid fa-upload"></i> Cargar Backup</h4>
                    <div class="flex flex-col gap-2">
                        <label class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2 cursor-pointer">
                            <i class="fa-solid fa-file-arrow-up"></i> Cargar desde archivo
                            <input type="file" id="importFile" class="hidden" accept=".txt,.json,text/plain,application/json" onchange="importFromFile(this)">
                        </label>
                        <button onclick="showPasteArea()" class="w-full bg-white border border-blue-300 text-blue-700 py-2 px-4 rounded-lg transition hover:bg-blue-50 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-paste"></i> Pegar desde portapapeles
                        </button>
                    </div>
                    
                    <!-- √Årea de pegar -->
                    <div id="paste-area" class="hidden mt-3">
                        <textarea id="paste-input" rows="4" class="w-full bg-white border border-blue-200 rounded-lg p-3 text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Pega aqu√≠ los datos del backup..."></textarea>
                        <button onclick="importFromPaste()" class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
                            <i class="fa-solid fa-check"></i> Cargar datos pegados
                        </button>
                    </div>
                </div>

                <!-- Info -->
                <p class="text-xs text-slate-400 text-center">
                    <i class="fa-solid fa-info-circle"></i> En m√≥vil: usa "Copiar" y "Pegar" para transferir datos entre dispositivos
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- Referencias DOM ---
        const totalIncomeEl = document.getElementById('total-income');
        const totalPaidEl = document.getElementById('total-paid');
        const totalPendingEl = document.getElementById('total-pending');
        const balanceEl = document.getElementById('balance');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const list = document.getElementById('list');
        const emptyState = document.getElementById('empty-state');
        const form = document.getElementById('form');
        const typeInput = document.getElementById('type');
        const textInput = document.getElementById('text');
        const amountInput = document.getElementById('amount');
        const dateInput = document.getElementById('date');
        const categoryInput = document.getElementById('category');

        // --- Categor√≠as Expandidas ---
        const categories = {
            // Ingresos
            ingreso: {
                salario: { label: 'üí∞ Salario', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-money-bill-wave' },
                freelance: { label: 'üíº Freelance', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-laptop' },
                otros_ingresos: { label: 'üì• Otros Ingresos', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-hand-holding-dollar' }
            },
            // Gastos
            gastos: {
                // Servicios
                luz: { label: 'üí° Luz', color: 'text-yellow-600', bg: 'bg-yellow-100', icon: 'fa-lightbulb' },
                gas: { label: 'üî• Gas', color: 'text-orange-600', bg: 'bg-orange-100', icon: 'fa-fire' },
                agua: { label: 'üíß Agua', color: 'text-cyan-600', bg: 'bg-cyan-100', icon: 'fa-droplet' },
                internet: { label: 'üåê Internet', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-wifi' },
                celular: { label: 'üì± Celular', color: 'text-violet-600', bg: 'bg-violet-100', icon: 'fa-mobile-screen' },
                netflix: { label: 'üé¨ Netflix', color: 'text-red-600', bg: 'bg-red-100', icon: 'fa-tv' },
                hbo: { label: 'üì∫ HBO', color: 'text-purple-600', bg: 'bg-purple-100', icon: 'fa-film' },
                disney: { label: '‚ú® Disney+', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-wand-magic-sparkles' },
                spotify: { label: 'üéµ Spotify', color: 'text-green-600', bg: 'bg-green-100', icon: 'fa-music' },
                // Casa
                alquiler: { label: 'üè† Alquiler/Hipoteca', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-house' },
                mantenimiento: { label: 'üîß Mantenimiento', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-wrench' },
                // Comida
                supermercado: { label: 'üõí Supermercado', color: 'text-emerald-600', bg: 'bg-emerald-100', icon: 'fa-cart-shopping' },
                comida: { label: 'üçî Comida/Delivery', color: 'text-orange-600', bg: 'bg-orange-100', icon: 'fa-utensils' },
                // Transporte
                transporte: { label: 'üöå Transporte', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-bus' },
                gasolina: { label: '‚õΩ Gasolina', color: 'text-amber-600', bg: 'bg-amber-100', icon: 'fa-gas-pump' },
                // Salud
                salud: { label: 'üíä Salud', color: 'text-teal-600', bg: 'bg-teal-100', icon: 'fa-heart-pulse' },
                gimnasio: { label: 'üèãÔ∏è Gimnasio', color: 'text-indigo-600', bg: 'bg-indigo-100', icon: 'fa-dumbbell' },
                // Familia
                ninos: { label: 'üë∂ Ni√±os', color: 'text-pink-600', bg: 'bg-pink-100', icon: 'fa-baby' },
                escuela: { label: 'üéì Escuela', color: 'text-indigo-600', bg: 'bg-indigo-100', icon: 'fa-graduation-cap' },
                // Entretenimiento
                salidas: { label: 'üçª Salidas', color: 'text-amber-600', bg: 'bg-amber-100', icon: 'fa-champagne-glasses' },
                cine: { label: 'üé¨ Cine', color: 'text-rose-600', bg: 'bg-rose-100', icon: 'fa-clapperboard' },
                regalos: { label: 'üéÅ Regalos', color: 'text-pink-600', bg: 'bg-pink-100', icon: 'fa-gift' },
                ocio: { label: 'üéâ Ocio', color: 'text-fuchsia-600', bg: 'bg-fuchsia-100', icon: 'fa-face-laugh' },
                // Otros
                ropa: { label: 'üëï Ropa', color: 'text-purple-600', bg: 'bg-purple-100', icon: 'fa-shirt' },
                educacion: { label: 'üìö Educaci√≥n', color: 'text-blue-600', bg: 'bg-blue-100', icon: 'fa-book' },
                otros: { label: 'üì¶ Otros', color: 'text-slate-600', bg: 'bg-slate-100', icon: 'fa-box' }
            }
        };

        // --- Estado ---
        const STORAGE_KEY = 'gastos_app_2026_v2';
        let items = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let currentTab = 'pending';

        // Fecha de hoy por defecto
        dateInput.valueAsDate = new Date();

        // --- Formateo de Moneda ---
        function formatCurrency(amount) {
            return amount.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // --- Funciones de Categor√≠as ---
        function updateCategoryOptions() {
            const type = typeInput.value;
            categoryInput.innerHTML = '';
            
            const cats = type === 'ingreso' ? categories.ingreso : categories.gastos;
            
            for (const [key, val] of Object.entries(cats)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = val.label;
                categoryInput.appendChild(option);
            }
        }

        function getCategoryStyle(category) {
            return categories.ingreso[category] || categories.gastos[category] || categories.gastos.otros;
        }

        // --- Funciones CRUD ---
        function addItem(e) {
            e.preventDefault();
            
            if (!textInput.value.trim() || !amountInput.value) {
                return alert('Por favor completa todos los campos');
            }

            const item = {
                id: Date.now(),
                text: textInput.value.trim(),
                amount: parseFloat(amountInput.value),
                date: dateInput.value,
                category: categoryInput.value,
                type: typeInput.value,
                paid: typeInput.value === 'ingreso' // Ingresos se marcan como "procesados" autom√°ticamente
            };

            items.push(item);
            saveAndRender();
            
            // Reset form
            textInput.value = '';
            amountInput.value = '';
        }

        function deleteItem(id) {
            if (confirm('¬øEliminar este item?')) {
                items = items.filter(item => item.id !== id);
                saveAndRender();
            }
        }

        function togglePaid(id) {
            const item = items.find(i => i.id === id);
            if (item && item.type === 'gasto') {
                item.paid = !item.paid;
                if (item.paid) {
                    item.paidDate = new Date().toISOString().slice(0, 10);
                } else {
                    delete item.paidDate;
                }
                saveAndRender();
            }
        }

        // --- Renderizado ---
        function renderList() {
            list.innerHTML = '';
            
            let filteredItems = [];
            
            if (currentTab === 'pending') {
                filteredItems = items.filter(i => i.type === 'gasto' && !i.paid);
            } else if (currentTab === 'paid') {
                filteredItems = items.filter(i => i.type === 'gasto' && i.paid);
            } else if (currentTab === 'income') {
                filteredItems = items.filter(i => i.type === 'ingreso');
            }

            // Ordenar por fecha
            filteredItems.sort((a, b) => new Date(a.date) - new Date(b.date));

            if (filteredItems.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');

            filteredItems.forEach(item => {
                const li = document.createElement('li');
                const style = getCategoryStyle(item.category);
                
                li.className = 'fade-in bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center group';
                
                const isExpense = item.type === 'gasto';
                const amountColor = isExpense ? 'text-rose-600' : 'text-emerald-600';
                const amountSign = isExpense ? '-' : '+';

                li.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full ${style.bg} flex items-center justify-center ${style.color} text-lg shrink-0">
                            <i class="fa-solid ${style.icon}"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">${item.text}</p>
                            <p class="text-xs text-slate-400 font-medium">
                                ${item.date} &bull; <span class="capitalize">${style.label.replace(/^[^\s]+\s/, '')}</span>
                                ${item.paidDate ? `&bull; <span class="text-emerald-500">Pagado ${item.paidDate}</span>` : ''}
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <p class="font-bold ${amountColor} text-lg">
                            ${amountSign}$${formatCurrency(item.amount)}
                        </p>
                        <div class="flex gap-1">
                            ${isExpense ? `
                                <button onclick="togglePaid(${item.id})" class="p-2 rounded-lg ${item.paid ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-400 hover:bg-emerald-100 hover:text-emerald-600'} transition" title="${item.paid ? 'Marcar como pendiente' : 'Marcar como pagado'}">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                            ` : ''}
                            <button onclick="deleteItem(${item.id})" class="p-2 rounded-lg bg-slate-100 text-slate-400 hover:bg-rose-100 hover:text-rose-600 transition opacity-0 group-hover:opacity-100" title="Eliminar">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                list.appendChild(li);
            });
        }

        function updateTotals() {
            const incomeItems = items.filter(i => i.type === 'ingreso');
            const paidItems = items.filter(i => i.type === 'gasto' && i.paid);
            const pendingItems = items.filter(i => i.type === 'gasto' && !i.paid);

            const totalIncome = incomeItems.reduce((acc, i) => acc + i.amount, 0);
            const totalPaid = paidItems.reduce((acc, i) => acc + i.amount, 0);
            const totalPending = pendingItems.reduce((acc, i) => acc + i.amount, 0);
            const balance = totalIncome - totalPaid;

            totalIncomeEl.textContent = `$${formatCurrency(totalIncome)}`;
            totalPaidEl.textContent = `$${formatCurrency(totalPaid)}`;
            totalPendingEl.textContent = `$${formatCurrency(totalPending)}`;
            balanceEl.textContent = `$${formatCurrency(balance)}`;

            // Actualizar contadores de tabs
            document.getElementById('pending-count').textContent = pendingItems.length;
            document.getElementById('paid-count').textContent = paidItems.length;
            document.getElementById('income-count').textContent = incomeItems.length;

            // Barra de progreso
            const totalExpenses = paidItems.length + pendingItems.length;
            const progress = totalExpenses > 0 ? (paidItems.length / totalExpenses) * 100 : 0;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${paidItems.length} de ${totalExpenses} pagados`;
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Actualizar estilos de tabs
            document.querySelectorAll('[id^="tab-"]').forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('text-slate-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('text-slate-500');
            
            renderList();
        }

        function saveAndRender() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
            renderList();
            updateTotals();
        }

        function confirmClear() {
            if (confirm('¬øBorrar TODO el historial? Esta acci√≥n no se puede deshacer.')) {
                items = [];
                saveAndRender();
            }
        }

        // --- Backup Modal ---
        function openBackupModal() {
            document.getElementById('backup-modal').classList.remove('hidden');
            document.getElementById('paste-area').classList.add('hidden');
        }

        function closeBackupModal() {
            document.getElementById('backup-modal').classList.add('hidden');
        }

        function showPasteArea() {
            document.getElementById('paste-area').classList.remove('hidden');
            document.getElementById('paste-input').value = '';
            document.getElementById('paste-input').focus();
        }

        // --- Backup/Restore ---
        function getBackupData() {
            return JSON.stringify(items);
        }

        function exportAsFile() {
            if (items.length === 0) return alert('No hay datos para exportar');
            
            const data = getBackupData();
            const blob = new Blob([data], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.download = `backup_gastos_${new Date().toISOString().slice(0, 10)}.txt`;
            a.href = url;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Archivo descargado. B√∫scalo en tu carpeta de Descargas.');
        }

        async function copyToClipboard() {
            if (items.length === 0) return alert('No hay datos para copiar');
            
            try {
                await navigator.clipboard.writeText(getBackupData());
                alert('‚úÖ Datos copiados al portapapeles.\n\nAhora puedes pegarlos en otro dispositivo.');
            } catch (err) {
                // Fallback para navegadores sin soporte
                const textarea = document.createElement('textarea');
                textarea.value = getBackupData();
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ Datos copiados al portapapeles.');
            }
        }

        function importFromFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                processImportData(e.target.result);
            };
            reader.readAsText(file);
            input.value = '';
        }

        function importFromPaste() {
            const pasteInput = document.getElementById('paste-input');
            const data = pasteInput.value.trim();
            
            if (!data) return alert('Por favor pega los datos primero');
            
            processImportData(data);
        }

        function processImportData(rawData) {
            try {
                const data = JSON.parse(rawData);
                if (Array.isArray(data)) {
                    if (confirm(`Se cargar√°n ${data.length} items. ¬øReemplazar datos actuales?`)) {
                        items = data;
                        saveAndRender();
                        closeBackupModal();
                        alert('‚úÖ Datos cargados correctamente');
                    }
                } else {
                    alert('‚ùå Formato de datos incorrecto');
                }
            } catch (err) {
                alert('‚ùå Error al leer los datos. Verifica que el formato sea correcto.');
            }
        }

        // --- Inicializaci√≥n ---
        function init() {
            updateCategoryOptions();
            renderList();
            updateTotals();
        }

        form.addEventListener('submit', addItem);
        init();
    </script>
</body>
</html>